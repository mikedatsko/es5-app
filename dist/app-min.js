function Data(){this.create=function(t,e){return t=t||prompt("Key:"),e=e||prompt("Data:"),void 0===t?(console.error("No key"),!1):void 0===e?(console.error("No data"),!1):void localStorage.setItem(t,e)},this.read=function(t){return void 0===t?(console.error("No data"),!1):localStorage.getItem(t)||(console.error("No data"),!1)},this.update=function(t,e){return t=t||prompt("Key:"),e=e||prompt("Data:"),void 0===t?(console.error("No key"),!1):void 0===e?(console.error("No data"),!1):localStorage.getItem(t)?void localStorage.setItem(t,e):(console.error("No data found"),!1)},this.delete=function(t){return void 0===(t=t||prompt("Key:"))?(console.error("No key"),!1):localStorage.getItem(t)?void localStorage.removeItem(t):(console.error("No data found"),!1)}}function Events(){}function Markup(){}function getId(){for(var t="",e=0;e<6;e++)t+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())];return t}function AddTodo(){var t=this,e=markup.create({className:"row",parent:"#todo_add"}),a=markup.create({className:"col-lg-12",parent:e}),o=markup.create({tag:"form",attrs:[{action:"javascript:void(0)"},{method:"POST"}],parent:a}),n=markup.create({className:"input-group",parent:o}),r=markup.create({tag:"input",attrs:[{type:"text"},{placeholder:"Todo text..."}],className:"form-control",parent:n}),s=markup.create({tag:"span",className:"input-group-btn",parent:n}),c=markup.create({tag:"button",attrs:[{type:"submit"}],content:"Add",className:"btn btn-primary",parent:s});events.on(o,"submit",function(e){e.preventDefault(),t.add(o,r,c)}),events.subscribe("edit-todo-item",function(e){var a=e.detail;a.todo&&t.edit(o,r,c,a)})}function ListTodos(){var t=data.read("todos");t||(t=[],data.update("todos",JSON.stringify(t)));var e=this;events.subscribe("get-todos-list",function(){e.getList()})}function App(){window.parent.postMessage("FRAME_LOADED","http://jsmeasure.surge.sh");for(var t=[],e=0;e<1e3;e++)t.push({text:"Test",checked:!1});data.update("todos",JSON.stringify(t)),listTodos.getList()}var data=new Data;Events.prototype.on=function(t,e,a){t.addEventListener(e,a,!1)},Events.prototype.subscribe=function(t,e){document.addEventListener(t,e,!1)},Events.prototype.send=function(t,e){e=e||{};var a=new CustomEvent(t,{detail:e});document.dispatchEvent(a)},Events.prototype.deleteEvent=function(){document.removeEventListener(eventName,callback,!1)};var events=new Events;Markup.prototype.create=function(t){var e={tag:"div",content:"",parent:"body",className:"",id:"",callback:void 0,attrs:[]};t=t||{};for(var a in e)t.hasOwnProperty(a)||(t[a]=e[a]);var o;if("input#checkbox"===t.tag?(o=document.createElement("input"),o.type="checkbox",o.value=1):o=document.createElement(t.tag),o.innerHTML=t.content,t.className&&(o.className+=t.className),t.id&&(o.id=t.id),"form"===t.tag&&(o.action="javascript:void(0)",o.method="post"),t.attrs.length&&t.attrs.forEach(function(t){for(var e in t)o[e]=t[e]}),t.parent){var n="string"==typeof t.parent?document.querySelector(t.parent):t.parent;if(!n)return console.error("No element found"),!1;n.appendChild(o)}else document.body.appendChild(o);return o},Markup.prototype.update=function(t,e){this.find(t)[0].innerHTML=e},Markup.prototype.delete=function(t){this.find(t)[0].remove()},Markup.prototype.find=function(t){return document.querySelectorAll(t)};var markup=new Markup;AddTodo.prototype.add=function(t,e,a){var o=data.read("todos");o?o=JSON.parse(o):(o=[],data.create("todos",JSON.stringify([]))),t.type&&"save"===t.type.value&&t.index?(o[+t.index.value].text=e.value,t.type.remove(),t.index.remove()):o.push({text:e.value,checked:!1}),a.innerHTML="Add",data.update("todos",JSON.stringify(o)),t.reset(),events.send("get-todos-list")},AddTodo.prototype.edit=function(t,e,a,o){t.type?t.type.value="save":markup.create({tag:"input",attrs:[{type:"hidden"},{name:"type"},{value:"save"}],className:"form-control",parent:t}),t.index?t.index.value=o.index:markup.create({tag:"input",attrs:[{type:"hidden"},{name:"index"},{value:o.index}],className:"form-control",parent:t}),a.innerHTML="Save",e.value=o.todo.text};var addTodo=new AddTodo;ListTodos.prototype.getList=function(){var t=this,e=data.read("todos");e=JSON.parse(e);var a=document.getElementById("todo_items");a.innerHTML="";var o=markup.create({tag:"tbody",parent:a});if(!e.length)return!1;e.forEach(function(a,n){var r=markup.create({tag:"tr",parent:o,className:a.checked?"success":""}),s=markup.create({tag:"td",parent:r,attrs:[{width:"30"}]}),c=markup.create({tag:"td",parent:r,content:a.text,className:a.checked?"checked":""}),d=markup.create({tag:"td",parent:r,attrs:[{width:"70"}]}),i=markup.create({tag:"span",className:"glyphicon glyphicon-"+(a.checked?"check":"unchecked"),parent:s}),p=markup.create({tag:"button",attrs:[{type:"button"}],className:"btn btn-info btn-xs",content:'<span class="glyphicon glyphicon-pencil"></span>',parent:d}),u=markup.create({tag:"button",attrs:[{type:"button"}],className:"btn btn-danger btn-xs",content:'<span class="glyphicon glyphicon-remove"></span>',parent:d});events.on(s,"click",function(o){o.preventDefault(),t.doCheck(r,i,c,e,a,n)}),events.on(c,"click",function(o){o.preventDefault(),t.doCheck(r,i,c,e,a,n)}),events.on(u,"click",function(a){t.delete(n,e)}),events.on(p,"click",function(t){events.send("edit-todo-item",{todo:a,index:n})})})},ListTodos.prototype.doCheck=function(t,e,a,o,n,r){"glyphicon glyphicon-check"===e.className?(t.className="",e.className="glyphicon glyphicon-unchecked",a.className="",n.checked=!1):(t.className="success",e.className="glyphicon glyphicon-check",a.className="checked",n.checked=!0),o[r]=n,data.update("todos",JSON.stringify(o)),events.send("get-todos-list")},ListTodos.prototype.delete=function(t,e){e.splice(t,1),data.update("todos",JSON.stringify(e)),events.send("get-todos-list")};var listTodos=new ListTodos,app=new App;
//# sourceMappingURL=app-min.js.map
